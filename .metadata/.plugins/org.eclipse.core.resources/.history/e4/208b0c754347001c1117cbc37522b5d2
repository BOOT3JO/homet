package com.homet.controller;

import java.util.List;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;
import org.thymeleaf.ITemplateEngine;
import org.thymeleaf.context.WebContext;

import com.homet.model.Health;
import com.homet.service.HealthService;

@Controller
@RequestMapping("/health")
public class HealthController {
	
	@Autowired
	HealthService service;
	//
	//@PostMapping("")
	//public Health post(@RequestBody Health health) {
	//	healthMapper.insert(health);
	///	return health;					//데이터 입력
	//}
	//
	/*
	 * @RequestMapping(value="/healthall", method = RequestMethod.GET) public String
	 * healthgetList() { return "healthall"; }
	 */
	/*@RequestMapping("/healthall")
	public String healthgetList(Model model){
		
		List<Health> list = new ArrayList<Health>();
		list = service.healthList();
		model.addAttribute("list",list);
		System.out.println(list);
		return "healthall";				//전체조회
	}*/
	
	@RequestMapping("/healthall")
	public String healthgetList(Model model,HttpServletRequest request, HttpServletResponse response, ServletContext servletContext, ITemplateEngine templateEngine)
	throws Exception{
		
	
	    List<Health> healthList = healthService.healthList(); 
	    
	    WebContext ctx = new WebContext(request, response, servletContext, request.getLocale());
	    ctx.setVariable("health", healthList);
	    
	    templateEngine.process("health/list", ctx, response.getWriter());
		
		return "healthall";				//전체조회
	}
	
	//@GetMapping("/{hidx}")
	//public Health getById(@PathVariable("hidx")int hidx){
	//	return healthMapper.getByID(hidx);			// idx 로조회
	//}
	//
	//@RequestMapping(value={"/healthall"})   //(value={"/","/list"})
	//public String health(Model model) {
		
	//	List<Health> list = healthMapper.getList();
	//	model.addAttribute("list", list);           //전체 리스트조회
	//	System.out.println(list);
	//	return "/healthall";
	//}
	//@RequestMapping(value = "/healthall", method = RequestMethod.GET)
    //public String healthall() {
        // 맵퍼로부터 리스트를 받아옴.
    //    List<Health> health = healthMapper.getList();
    //   return "/healthall";
    //}
	
	@RequestMapping(value="/", method = RequestMethod.GET)
	public String healthView() {
		return "health";
	}
	
	@RequestMapping(value="/kakaoMap", method = RequestMethod.GET)  //헬스장 위치조회
	public String kakaoMap() {
		return "kakaoMap";
	}
	
	
	//@RequestMapping(value="/healthView", method=RequestMethod.POST)
	//public String healthViewPOST(Health health) {
		
	 
	//	return "redirect:/healthView";
	//}
	@ExceptionHandler(NumberFormatException.class)
	public ModelAndView handleErr(HttpServletRequest request ) {
		ModelAndView mav = new ModelAndView();
		mav.addObject("url", request.getRequestURL());   //애트리뷰트 저장
		mav.setViewName("/error/error");
		return mav;
	}
}


